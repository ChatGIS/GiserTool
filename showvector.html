<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>显示矢量数据</title>
		<!-- CDN -->
		<link href="https://openlayers.org/en/v4.6.5/css/ol.css" rel="stylesheet" type="text/css">
		<script src="http://cdn.staticfile.org/jquery/2.0.0/jquery.min.js"></script>
		<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
		<script src="../js/util.js"></script>
		<!-- 本地资源 -->
		<!-- <link href="../js/openLayersv4.1.1/ol.css" rel="stylesheet" type="text/css"/>
		<script src="../js/openLayersv4.1.1/ol.js" type="text/javascript" charset="UTF-8"></script>
		<script src="../js/jquerymin.js" type="text/javascript" charset="UTF-8"></script>-->
	</head>
	<body>
		<div id="map" style="width: 100%;height: 800px;"></div>
		<script>
			//高德地图图层
			var gaodeTileLayer = new ol.layer.Tile({
				source: new ol.source.XYZ({
					url:'http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}'
				})
			});
			
			/* function addGeoJSON(src) {
				var a = (new ol.format.GeoJSON()).readProjection(src);
				var layer = new ol.layer.Vector({
					source: new ol.source.Vector({
						features: (new ol.format.GeoJSON()).readFeatures(src,{
							dataProjection: 'EPSG:3857',
							featureProjection: 'EPSG:4326'
						})
					})
				});
				var b = (new ol.format.GeoJSON()).readProjection(src);
				console.log(a);
				console.log(b);
				map.addLayer(layer);
			}
			var sourceCell=new ol.source.Vector();			
			$.ajax({
				url: "http://localhost:8082/geoserver/DreamiceWS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=DreamiceWS%3AProvinceChina&maxFeatures=5000&outputFormat=application%2Fjson",
				success: function(data,status){
					//addGeoJSON(data);
					var jsonRes = data;
					for(var i=0; i<jsonRes.features.length; i++){
						var cds=jsonRes.features[i].geometry.coordinates[0];
						//坐标转换
						var cds2=[];	//转换后坐标
						for(var j=0; j<cds[0].length; j++){
							//var cd=util.corToArr(cds[j],true);
							var cd = ol.proj.transform(cds[0][j], 'EPSG:3857', 'EPSG:4326')
							cds2.push(cd)
						}debugger
						var cds22 = [];
						cds22.push(cds2);
						jsonRes.features[i].geometry.coordinates[0]=[];
						jsonRes.features[i].geometry.coordinates[0]=cds22;
					}debugger
					features = new ol.format.GeoJSON().readFeatures(jsonRes);
					sourceCell.addFeatures(features);
					var layer = new ol.layer.Vector({
						source: sourceCell
					});
					map.addLayer(layer);
				}
			}) */
			
			 var layerProvince = new ol.layer.Vector({
				source: new ol.source.Vector({
					format: new ol.format.GeoJSON(),
					url: 'http://localhost:8082/geoserver/DreamiceWS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=DreamiceWS%3Agadm36_CHN_0&maxFeatures=50&outputFormat=application%2Fjson',
					//features: (new ol.format.GeoJSON()).readFeatures()
				})
			}); 
			
			var map = new ol.Map({
				layers:[gaodeTileLayer, layerProvince],
				view: new ol.View({
					center: [117.020847,36.670086],
					maxZoom: 19,
					zoom: 4,
					projection: 'EPSG:4326'
				}),
				target: 'map'
			})
			
			
			
		</script>
	</body>
</html>
